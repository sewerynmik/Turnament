@model IEnumerable<Match>

<style>
    .tournament-bracket {
        display: flex;
        flex-direction: row;
        gap: 2em;
        overflow-x: auto;
        padding: 2em;
    }

    .bracket-round {
        min-width: 200px;
        display: flex;
        flex-direction: column;
        gap: 1em;
    }

    .bracket-match {
        border: 1px solid #ccc;
        padding: 1em;
        border-radius: 4px;
        background: white;
    }

    .bracket-team {
        padding: 0.5em;
        margin: 0.2em 0;
    }

    .winner {
        background: #e8f5e9;
        font-weight: bold;
        border-radius: 4px;
    }

    .bracket-actions {
        margin-top: 1em;
        display: flex;
        gap: 0.5em;
    }
</style>

<h1>Drabinka turniejowa</h1>

<div class="tournament-bracket">
    @foreach (var round in Model.GroupBy(m => m.Round).OrderBy(g => g.Key))
    {
        <div class="bracket-round">
            <h3>Runda @round.Key</h3>
            
            @foreach (var match in round)
            {
                <div class="bracket-match">
                    <div class="bracket-team @(match.WinnerId == match.Team1Id ? "winner" : "")">
                        @(match.Team1?.Name ?? "TBD")
                    </div>
                    <div class="bracket-team @(match.WinnerId == match.Team2Id ? "winner" : "")">
                        @(match.Team2?.Name ?? "TBD")
                    </div>
                    
                    @if (!match.WinnerId.HasValue && 
                         match.Team1Id.HasValue && 
                         match.Team2Id.HasValue && 
                         (ViewBag.IsOrganizer ?? false))
                    {
                        <div class="bracket-actions">
                            <form asp-action="UpdateMatchResult" method="post" class="d-inline">
                                <input type="hidden" name="matchId" value="@match.Id"/>
                                <button type="submit" name="winnerId" value="@match.Team1Id"
                                        class="btn btn-sm btn-outline-success">
                                    Wygrana @match.Team1.Name
                                </button>
                                <button type="submit" name="winnerId" value="@match.Team2Id"
                                        class="btn btn-sm btn-outline-success">
                                    Wygrana @match.Team2.Name
                                </button>
                            </form>
                        </div>
                    }

                    @if (match.ScheduledAt.HasValue)
                    {
                        <div class="text-muted mt-2 small">
                            @match.ScheduledAt.Value.ToString("dd.MM.yyyy HH:mm")
                        </div>
                    }
                </div>
            }
        </div>
    }
</div>

<div class="mt-3">
    <a asp-controller="Tournaments" asp-action="Details" asp-route-id="@Model.First().TournamentId"
       class="btn btn-secondary">Powrót</a>
</div>